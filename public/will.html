<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Will - Spots</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 24px auto;
      padding: 0 16px;
    }

    form {
      margin-bottom: 16px;
    }

    input {
      padding: 8px;
      font-size: 14px;
      width: 70%;
    }

    button {
      padding: 8px 12px;
      font-size: 14px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .time {
      color: #666;
      font-size: 12px;
      margin-left: 8px;
    }
  </style>
</head>

<body>
  <h1>Welcome to Will's World Travel Guide</h1>
  <h4>The Top Spots</h4>
  <p>
    <strong>1. Paris, France</strong>&#129366;<br>
    <strong>2. Madrid, Spain</strong>&#128131;<br>
    <strong>3. Toyko, Japan</strong>&#128510;<br>
    <strong>4. Rome, Italy</strong>&#127963;<br>
    <strong>5. Milan, Italy</strong>&#9962;<br>
    <strong>6. New York City, US</strong>&#128509;<br>
    <strong>7. Amsterdam, Netherlands</strong>&#127799;<br>
    <strong>8. Sydney, Australia</strong>&#127753;<br>
    <strong>9. Singapore, Singapore</strong>&#127750;<br>
    <strong>10. London, United Kingdom</strong>&#128130;<br>
  </p>
  <h4>The Goal</h4>
  <p>The Goal of this website is to come up with a list of places that you
    would like to go in your lifetime. I have listed above a few of the places
    that most people say you should see in your lifetime. After you look around and find
    some places you love and want to go, add them to the list!
  </p>
  <h1>Save a place</h1>

  <form id="spotForm">
    <input id="place" name="place" placeholder="Enter place" required />
    <button type="submit">Save</button>
  </form>

  <h2>Saved places</h2>
  <ul id="spotsList"></ul>

  <script>
    const form = document.getElementById('spotForm');
    const placeInput = document.getElementById('place');
    const spotsList = document.getElementById('spotsList');

    // helper to render a spot item
    function renderSpot(spot) {
      const li = document.createElement('li');
      li.dataset.id = spot._id;
      const text = document.createElement('span');
      text.textContent = spot.place;
      const time = document.createElement('span');
      time.className = 'time';
      time.textContent = `(${new Date(spot.createdAt).toLocaleString()})`;

      const editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.style.marginLeft = '8px';
      editBtn.addEventListener('click', () => editSpot(spot._id));

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.style.marginLeft = '6px';
      delBtn.addEventListener('click', () => deleteSpot(spot._id));

      li.appendChild(text);
      li.appendChild(time);
      li.appendChild(editBtn);
      li.appendChild(delBtn);

      spotsList.insertBefore(li, spotsList.firstChild);
    }

    async function loadSpots() {
      try {
        const res = await fetch('/api/spots');
        if (!res.ok) throw new Error('Failed to load');
        const data = await res.json();
        spotsList.innerHTML = '';
        data.forEach(renderSpot);
      } catch (err) {
        console.error(err);
      }
    }

    async function editSpot(id) {
      const li = document.querySelector(`li[data-id="${id}"]`);
      const current = li ? li.querySelector('span').textContent : '';
      const newPlace = prompt('Edit place', current);
      if (!newPlace || newPlace.trim() === current) return;
      try {
        const res = await fetch(`/api/spots/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ place: newPlace.trim() })
        });
        if (!res.ok) {
          console.error('Edit failed', await res.json().catch(()=>({})));
          return;
        }
        const updated = await res.json();
        if (li) li.querySelector('span').textContent = updated.place;
      } catch (err) {
        console.error('Edit request error', err);
      }
    }

    async function deleteSpot(id) {
      if (!confirm('Delete this place?')) return;
      try {
        const res = await fetch(`/api/spots/${id}`, { method: 'DELETE' });
        if (!res.ok) {
          console.error('Delete failed', await res.json().catch(()=>({})));
          return;
        }
        const li = document.querySelector(`li[data-id="${id}"]`);
        if (li) li.remove();
      } catch (err) {
        console.error('Delete request error', err);
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const place = placeInput.value.trim();
      if (!place) return;
      try {
        const res = await fetch('/api/spots', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ place })
        });
        if (!res.ok) {
          const err = await res.json().catch(() => ({ error: 'unknown' }));
          console.error('Save failed', err);
          return;
        }
        const saved = await res.json();
        renderSpot(saved);
        placeInput.value = '';
        placeInput.focus();
      } catch (err) {
        console.error('Request error', err);
      }
    });
    loadSpots();
  </script>
</body>

</html>